services:
  traefik-agent:
    image: hhftechnology/traefik-log-dashboard-agent:latest
    restart: unless-stopped
    volumes:
      - ./data/logs:/logs:ro
      - ./data/positions:/data
    environment:
      TRAEFIK_LOG_DASHBOARD_ACCESS_PATH: "/logs/access.log"
      TRAEFIK_LOG_DASHBOARD_ERROR_PATH: "/logs/traefik.log"
      TRAEFIK_LOG_DASHBOARD_AUTH_TOKEN: "c3c576623a85d80c61d9848046d8821399d7204843d06cbeeafae77feebcc1d7"
      TRAEFIK_LOG_DASHBOARD_SYSTEM_MONITORING: "true"
      TRAEFIK_LOG_DASHBOARD_LOG_FORMAT: "json"
      TRAEFIK_LOG_DASHBOARD_GEOIP_ENABLED: "true"
      PORT: "5000"
    healthcheck:
      test: 
        - "CMD" 
        - "wget"
        - "--no-verbose"
        - "--tries=1"
        - "--spider"
        - "http://localhost:5000/api/logs/status"
      interval: 2m
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      docker-net:

  traefik-dashboard:
    image: hhftechnology/traefik-log-dashboard:latest
    restart: unless-stopped
    ports:
      - "3001:3001"
    volumes:
      - ./data/dashboard:/app/data
      - ./data/positions:/data
    environment:
      # Agent Configuration - REPLACE WITH YOUR TOKEN
      AGENT_API_URL: http://traefik-agent:5000
      AGENT_API_TOKEN: c3c576623a85d80c61d9848046d8821399d7204843d06cbeeafae77feebcc1d7
      AGENT_NAME: Default Agent
      NODE_ENV: production
      PORT: 3001      
      NEXT_PUBLIC_SHOW_DEMO_PAGE: false
      NEXT_PUBLIC_MAX_LOGS_DISPLAY: 500
      ALLOWED_ORIGINS: https://traefik-dashboard.127-0-0-1.traefik.me

    depends_on:
      traefik-agent:
        condition: service_healthy
    networks:
      docker-net:
    labels:
      traefik.enable: true
      traefik.http.services.traefik-dashboard-svc.loadbalancer.server.port: "3001"
      traefik.http.routers.traefik-dashboard-rtr.entrypoints: https
      traefik.http.routers.traefik-dashboard-rtr.rule: Host(`traefik-dashboard.127-0-0-1.traefik.me`)
      traefik.http.routers.traefik-dashboard-rtr.tls: true
      traefik.http.routers.traefik-dashboard-rtr.tls.certresolver: letsencrypt
      traefik.http.routers.traefik-dashboard-rtr.service: "traefik-dashboard-svc"

networks:
  docker-net:
    external: true